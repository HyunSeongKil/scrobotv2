<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="PopCommonCodeManage">
	
	<select id="userGroup" parameterType="Hashmap" resultType="HashMap">
	SELECT EG.MDFR_ID, EG.CD_GROUP_ID, EG.CD_GROUP_SEP, EG.CD_GROUP_NM, EG.PRJCT_ID, EG.CD_GROUP_DC, DATE_FORMAT(EG.MDFCN_DT,'%Y.%m.%d-%T') AS MDFCN_DT, MB.MBR_NM 
	FROM T_RE_ECG_002 EG, T_SP_MBR_009 MB
	WHERE EG.MDFR_ID = MB.MBR_ID AND EG.PRJCT_ID = #{prj_id}
	ORDER BY MDFCN_DT DESC
	</select>
	
	<select id="adminGroup" parameterType="Hashmap" resultType="HashMap">
	SELECT MDFR_ID AS MBR_NM, CD_GROUP_ID, CD_GROUP_SEP, CD_GROUP_NM, PRJCT_ID, CD_GROUP_DC, DATE_FORMAT(MDFCN_DT,'%Y.%m.%d-%T') AS MDFCN_DT	
	FROM T_RE_ECG_002
	WHERE MDFR_ID = 'ADMIN'
	ORDER BY MDFCN_DT DESC
	</select>
	
	<insert id="insertGroup" parameterType="Hashmap">
	INSERT INTO T_RE_ECG_002
	VALUES( (SELECT NEXTVAL(SEQ_RE_ECG_002)), #{group_sep}, #{GroupNm}, #{GroupDc}, #{user_id}, SYSDATE(), #{prjId})
	</insert>
	
	<update id="updateGroup" parameterType="HashMap">
	UPDATE T_RE_ECG_002
	SET CD_GROUP_NM = #{group_nm}, CD_GROUP_DC = #{group_dc}, MDFCN_DT = SYSDATE(), MDFR_ID = #{user_id}
	WHERE CD_GROUP_ID = #{group_id}
	
	</update>
	<delete id="deleteGroup" parameterType="Hashmap">
	DELETE
	FROM T_RE_ECG_002
	WHERE CD_GROUP_SEP = #{group_sep}
	</delete>
	
	<delete id="deleteGroupChildren" parameterType="Hashmap">
	DELETE
	FROM T_RE_ECD_001
	WHERE CD_GROUP_SEP = #{group_sep}
	</delete>
	
	<select id="selectCode" parameterType='HashMap' resultType="HashMap">
	SELECT *
	FROM T_RE_ECD_001
	where CD_GROUP_SEP = #{group_sep} and UP_CD = ""
	ORDER by SORT_ORDR
	</select>
	
	<insert id="inOrUpcmmnCode" parameterType='HashMap'>
	INSERT INTO T_RE_ECD_001
	VALUES(#{cmmnId}, #{groupId}, #{cmmnName}, #{cmmnExplanation}, #{upCd}, #{cdLevel}, #{cmmnSort})
	ON DUPLICATE KEY UPDATE
	CD_NM = #{cmmnName},
	CD_DC = #{cmmnExplanation},
	SORT_ORDR = #{cmmnSort}
	</insert>
	
	<delete id="deleteCmmnCode" parameterType="HashMap">
	DELETE
	FROM T_RE_ECD_001
	WHERE CD_ID = #{cmmn_id}
	</delete>
	
	<delete id="deleteCmmnCodeUp" parameterType="HashMap">
	DELETE
	FROM T_RE_ECD_001
	WHERE UP_CD = #{cmmn_id}
	</delete>
	
	
	<select id="searchCmmnCodeGroupUser" parameterType="HashMap" resultType="HashMap">
	SELECT EG.MDFR_ID, EG.CD_GROUP_ID, EG.CD_GROUP_NM, EG.PRJCT_ID, EG.CD_GROUP_DC, DATE_FORMAT(EG.MDFCN_DT,'%Y.%m.%d-%T') AS MDFCN_DT, MB.MBR_NM 
	FROM T_RE_ECG_002 EG, T_SP_MBR_009 MB
	<where>
		EG.MDFR_ID = MB.MBR_ID AND EG.PRJCT_ID = #{prj_id}
		<if test="option=='all'">
			AND (EG.CD_GROUP_ID like CONCAT('%',#{text},'%') OR MB.MBR_NM like CONCAT('%',#{text},'%') OR EG.CD_GROUP_NM like CONCAT('%',#{text},'%')
			OR EG.CD_GROUP_DC like CONCAT('%',#{text},'%') OR DATE_FORMAT(EG.MDFCN_DT,'%Y.%m.%d-%T') like CONCAT('%',#{text},'%'))
		</if>
		<if test="option=='name'">
			AND EG.CD_GROUP_NM like CONCAT('%',#{text},'%')
		</if>
		<if test="option=='explanation'">
			AND EG.CD_GROUP_DC like CONCAT('%',#{text},'%')
		</if>
	</where>
	ORDER BY MDFCN_DT DESC
	</select>
	
	<select id="searchCmmnCodeGroupAdmin" parameterType="Hashmap" resultType="HashMap">
	SELECT MDFR_ID AS MBR_NM, CD_GROUP_ID, CD_GROUP_NM, PRJCT_ID, CD_GROUP_DC, DATE_FORMAT(MDFCN_DT,'%Y.%m.%d-%T') AS MDFCN_DT	
	FROM T_RE_ECG_002
	<where>
		MDFR_ID = 'ADMIN'
		<if test="option=='all'">
			AND (CD_GROUP_ID like CONCAT('%',#{text},'%') OR  CD_GROUP_NM like CONCAT('%',#{text},'%')
			OR CD_GROUP_DC like CONCAT('%',#{text},'%') OR DATE_FORMAT(MDFCN_DT,'%Y.%m.%d-%T') like CONCAT('%',#{text},'%'))
		</if>
		<if test="option=='name'">
			AND CD_GROUP_NM like CONCAT('%',#{text},'%')
		</if>
		<if test="option=='explanation'">
			AND CD_GROUP_DC like CONCAT('%',#{text},'%')
		</if>
	</where>
	ORDER BY MDFCN_DT DESC
	</select>
	
	<select id="selectLowCode" parameterType="HashMap" resultType="HashMap">
	SELECT * 
	FROM T_RE_ECD_001
	WHERE UP_CD = #{cmmn_id}
	ORDER BY SORT_ORDR
	</select>
	
	<insert id="inOrUpcmmnLowCode" parameterType='HashMap'>
	INSERT INTO T_RE_ECD_001
	VALUES(#{cmmnLowId}, #{groupId}, #{cmmnLowName}, #{cmmnLowExplanation}, #{upCd}, #{cdLevel}, #{cmmnLowSort})
	ON DUPLICATE KEY UPDATE
	CD_NM = #{cmmnLowName},
	CD_DC = #{cmmnLowExplanation},
	SORT_ORDR = #{cmmnLowSort}
	</insert>
	
	<delete id="deleteCmmnLowCode" parameterType="HashMap">
	DELETE
	FROM T_RE_ECD_001
	WHERE CD_ID = #{cmmn_id}
	</delete>
	
	<select id="Tree1" parameterType="HashMap" resultType="HashMap">
	SELECT CD_ID, CD_SEP, CD_NM
	FROM T_RE_ECD_001
	WHERE CD_GROUP_ID = #{group_id} AND UP_CD = ""
	ORDER BY SORT_ORDR
	</select>
	
	<select id="Tree2" parameterType="HashMap" resultType="HashMap">
	SELECT CD_ID, CD_SEP, CD_NM
	FROM T_RE_ECD_001
	WHERE UP_CD = #{cmmn_id}
	ORDER BY SORT_ORDR
	</select>
	
	<select id="MaxECG"  resultType="string">
	SELECT MAX(REPLACE(CD_GROUP_SEP, "ECG", "")) FROM T_RE_ECG_002
	</select>
	
	<select id="MaxECD" resultType="string">
	SELECT MAX(REPLACE(CD_SEP, "ECD", "")) FROM T_RE_ECD_001
	</select>
</mapper>