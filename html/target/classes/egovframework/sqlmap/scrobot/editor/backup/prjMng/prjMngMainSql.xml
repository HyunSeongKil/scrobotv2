<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="prjMngMain">

	<insert id="insertPrj" parameterType="hashmap">

		/* prjMngMain.insertPrj*/

		INSERT INTO PRJCT
		VALUES (
		#{PRJ_ID}
		, #{PRJ_NM}
		, SYSDATE()
		, #{USER_ID})


	</insert>


	<select id="selectPrj" parameterType="hashmap"
		resultType="HashMap">

		/* prjMngMain."selectPrj"*/

		SELECT CASE WHEN COUNT(*) = 0
		THEN 'N'
		ELSE 'Y' END AS prjYn
		FROM PRJCT
		WHERE PRJ_ID = #{PRJ_ID}


	</select>



	<insert id="insertMenu" parameterType="hashmap">

		/* view010102.insertMenu*/

		INSERT INTO MENU(
		MENU_ID
		, PRJ_ID
		, MENU_NM
		, MENU_LVL
		, HRNK_MENU_ID
		, MENU_SEQ
		, MAKE_DTTM
		, CRTR_ID
		, VIEW_ID
		)
		VALUES (
		#{MENU_ID}
		, #{PRJ_ID}
		, #{MENU_NM}
		, #{MENU_LVL}
		, #{HRNK_MENU_ID}
		, #{MENU_SEQ}
		, SYSDATE()
		, #{USER_ID}
		, #{VIEW_ID})
		ON
		DUPLICATE KEY UPDATE
		MENU_NM = #{MENU_NM}
		, MENU_LVL = #{MENU_LVL}
		, HRNK_MENU_ID = #{HRNK_MENU_ID}
		, MENU_SEQ = #{MENU_SEQ}
		, MAKE_DTTM = SYSDATE()
		, CRTR_ID = #{USER_ID}
		, VIEW_ID = #{VIEW_ID}

	</insert>

	<delete id="deleteMenu" parameterType="hashmap">

		/* prjMngMain.deleteMenu*/

		DELETE FROM MENU
		WHERE PRJ_ID = #{PRJ_ID}
		AND
		MENU_ID NOT IN

		<foreach collection="deleteKey" item="item" open="(" close=")"
			separator=",">
			#{item}
		</foreach>

	</delete>


	<update id="updateViewInfo" parameterType="hashmap">

		/* prjMngMain.updateViewInfo */
		UPDATE MENU
		SET VIEW_ID = #{VIEW_ID}
		, CRTR_ID = #{USER_ID}
	
		WHERE PRJ_ID = #{PRJ_ID}
		AND MENU_ID = #{MENU_ID}


	</update>
	
	<update id="updateViewInfo_deleted" parameterType="hashmap">

		/* prjMngMain.updateViewInfo_deleted */
		UPDATE MENU
		SET VIEW_ID = ''
		  , CRTR_ID = #{USER_ID}
		
	
		WHERE MENU_ID = #{MENU_ID}
	    AND PRJ_ID = #{PRJ_ID}


	</update>

	<select id="retrievePrjInfo" parameterType="hashmap" resultType="HashMap">
		/* prjMngMain.retrievePrjInfo */

		SELECT PR.PRJ_ID
		, PR.PRJ_NM
		, PR.HEADER_OPEN_YN
		, PR.FOOTER_OPEN_YN
		FROM PRJCT PR
		WHERE PR.PRJ_ID = #{PRJ_ID}
	</select>
	
	
	<select id="retrieveMenuList" parameterType="hashmap" resultType="HashMap">

		/* prjMngMain.retrieveMenuList */


		SELECT PA.VIEW_ID
		, PA.VIEW_NM
		, PA.VIEW_LVL
		, PA.HRNK_VIEW_ID
		, PA.VIEW_SEQ
		, PA.VIEW_DVS
		, PA.DRCT_YN
		, PA.HIDN_YN
		, PA.CRTR_ID
		, PA.HTML_SOURCE
		FROM PAGE PA
		WHERE PA.PRJ_ID = #{PRJ_ID}
		ORDER BY VIEW_DVS, VIEW_LVL, HRNK_VIEW_ID, VIEW_SEQ

	</select>


	<select id="retrieveViewInfo" parameterType="hashmap"
		resultType="HashMap">

		/* prjMngMain.retrieveViewInfo */

		SELECT VIEW_ID
		, VIEW_NM
		,
		HTML_SOURCE
		, MENU_ID
		, PRJ_ID
		FROM VIEW
		WHERE MENU_ID = #{MENU_ID}
		AND
		PRJ_ID = #{PRJ_ID}
	</select>
	
	
	<select id="retrieveServiceViewInfo" parameterType="hashmap" resultType="HashMap">

		/* prjMngMain.retrieveServiceViewInfo */

		SELECT VIEW_NM
     		 , JSP_SOURCE
     		 , PRJ_NM
     		 , CONTROLLER_SOURCE
     		 , SERVICE_SOURCE
     		 , SQL_SOURCE
		 FROM PRJCT PR
		     , MENU ME
    		 , VIEW VI
		 WHERE PR.PRJ_ID = ME.PRJ_ID
		 AND ME.VIEW_ID = VI.VIEW_ID
		 AND PR.PRJ_ID = #{PRJ_ID}
	</select>


</mapper>