<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="viewEditDictionary">


	<select id="getWordList" resultType="Map">
		SELECT 
			WORD_NM
		,	WORD_ENG_ABRV_NM
		FROM
			WORD
		WHERE 
			WORD_NM 
		NOT IN (SELECT DOMN_CL_NM FROM DOMAIN GROUP BY DOMN_CL_NM)
	</select>
	
	<select id="getDomainList" resultType="Map">
		SELECT 
			WORD_NM AS DOMN_NM
		,	WORD_ENG_ABRV_NM AS DOMN_CL_NM
		FROM
			WORD
		WHERE
			WORD_NM
		IN (SELECT DOMN_CL_NM FROM DOMAIN GROUP BY DOMN_CL_NM)
	</select>
	
	<select id="getTermList" parameterType="Map" resultType="Map">
	
		<!-- 1. 전체 항목 찾기 -->
		<foreach item="item" collection="list" index="index">
			<choose>
				<when test='item.initial.equals("ㅎ")'>
					SELECT
					#{item.initial} AS INITIAL , TERM_NM , TERM_DC , TERM_ENG_ABRV_NM FROM term_temp WHERE TERM_NM RLIKE '^(${item.initial})' OR (TERM_NM <![CDATA[>= #{item.before}]]> ) ORDER BY INITIAL, TERM_NM
				</when>
				<otherwise>
					SELECT
					#{item.initial} AS INITIAL , TERM_NM , TERM_DC , TERM_ENG_ABRV_NM FROM term_temp WHERE TERM_NM RLIKE '^(${item.initial})' OR (TERM_NM <![CDATA[ >=]]> #{item.before} AND TERM_NM <![CDATA[ < ]]> #{item.after})
					UNION ALL 
				</otherwise>
			</choose>
		</foreach>
			<!-- SELECT WORD_NM AS TERM_NM
				, WORD_DC AS TERM_DC
				, WORD_ENG_ABRV_NM AS TERM_ENG_ABRV_NM
			FROM WORD
			UNION ALL
			SELECT TERM_NM 
					, TERM_DC 
					, TERM_ENG_ABRV_NM 
			FROM TERM -->
		
	</select>
	
	<select id="getUserFavoriteList" parameterType="String" resultType="Map">
	<!-- 2. 유저 즐겨찾기 항목 전제 조회  -->
		SELECT
			A.TERM_NM
		,	A.TERM_ENG_ABRV_NM
		,	B.TERM_DC
		FROM
			T_RE_TEF_007 A 
		INNER JOIN
			term_temp B 
		ON
			A.TERM_ENG_ABRV_NM = B.TERM_ENG_ABRV_NM
		WHERE
			A.MBR_ID = #{user_id}
	</select>
	
	<select id="getExplainTerm" parameterType="Map" resultType="Map">
		SELECT 
			TERM_NM
		,	DOMN_NM
		,	TERM_DC
		,	TERM_ENG_ABRV_NM
		FROM
			term_temp
		WHERE
			TERM_ENG_ABRV_NM = #{TERM_ENG_ABRV_NM}
	</select>
	
	<select id="getUfList" parameterType="String" resultType="Map">
		SELECT 
			TERM_ENG_ABRV_NM
		FROM
			T_RE_TEF_007
		WHERE
			MBR_ID = #{user_id}
	</select>
	
	<select id="findUserFavorite" parameterType="Map" resultType="Map">
		SELECT 
			*
		FROM
			T_RE_TEF_007
		WHERE
			MBR_ID = #{user_id}
		AND
			TERM_ENG_ABRV_NM = #{TERM_ENG_ABRV_NM}
	</select>
	
	<insert id="insertUserFavorite" parameterType="Map">
		INSERT INTO T_RE_TEF_007 (MBR_ID , TERM_NM , TERM_ENG_ABRV_NM)
		VALUES(
			#{user_id}
		,	(SELECT TERM_NM FROM TERM WHERE TERM_ENG_ABRV_NM = #{TERM_ENG_ABRV_NM})
		,	#{TERM_ENG_ABRV_NM}
		) 
			
		
	</insert>
	
	<delete id="deleteUserFavorite" parameterType="Map">
		DELETE 
		FROM
			T_RE_TEF_007
		WHERE
			MBR_ID = #{user_id}
		AND
			TERM_ENG_ABRV_NM = #{TERM_ENG_ABRV_NM}
		
	</delete>
	
</mapper>






