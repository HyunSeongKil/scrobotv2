<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="UserMessage">
	<select id="userMessage" parameterType="hashmap" resultType="HashMap">
	SELECT MA.MESSAGE_CN, MA.MESSAGE_ID, MA.MESSAGE_SEP, MA.MESSAGE_NM, MA.WRTR_ID, DATE_FORMAT(MA.WRT_DT,'%Y.%m.%d') AS WRT_DT, MB.MBR_NM
	FROM T_RE_MSG_003 MA, MBR MB
	WHERE MA.WRTR_ID = MB.MBR_ID AND MA.PRJCT_ID = #{prj_id}
	ORDER BY WRT_DT DESC
	</select>
	
	<select id="adminMessage" parameterType="hashmap" resultType="HashMap">
	SELECT MA.MESSAGE_SEP, MA.MESSAGE_ID, MA.MESSAGE_NM, MA.MESSAGE_CN, MA.WRTR_ID, DATE_FORMAT(MA.WRT_DT,'%Y.%m.%d') AS WRT_DT 
	FROM T_RE_MSG_003 MA
	WHERE WRTR_ID ='ADMIN'
	order by WRT_DT DESC
	</select>
	
	<select id="selectUserNm" parameterType="hashmap" resultType="HashMap">
	SELECT MBR_NM, MBER_ID FROM MBR WHERE MBR_ID = #{id}
	</select>
	
	<insert id="insertOrUpdateMessage" parameterType="hashmap">
	INSERT INTO T_RE_MSG_003 
	VALUES(#{msg_id}, #{msg_seq}, #{msg_nm}, #{msg_cn}, #{USER_ID}, SYSDATE(), #{prjct_id})
	ON DUPLICATE KEY UPDATE
	MESSAGE_SEP = #{msg_seq},
	MESSAGE_NM = #{msg_nm},
	MESSAGE_CN = #{msg_cn},
	WRTR_ID = #{USER_ID},
	WRT_DT = SYSDATE()
	</insert>
	
	<delete id="deleteMessage" parameterType="hashmap">
	DELETE
	FROM T_RE_MSG_003
	WHERE MESSAGE_ID = #{msg_id}
	</delete>
</mapper>
