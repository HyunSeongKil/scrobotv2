<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CommonCodeGroupManage">

	<!-- 공통 코드 그룹 갯수 조회 -->
		<select id="getCommonCodeGroupCount" resultType ="Integer">
		
		/* CommonCodeGroupManage.getCommonCodeGroupCount */
		
			SELECT 
				COUNT(*) AS COUNT_NUM 
			FROM
				CMMN_GROUP_CD
			WHERE 
				DEL_YN = "N"
		</select>
	
	<!-- 공통 코드 목록 조회 -->
	<select id="selectCmnCdGroupList" resultType="HashMap">
	
	/* CommonCodeGroupManage.selectCmnCdGroupList */
	
	<![CDATA[
		SELECT S.*
			FROM(
				SELECT
					FORMAT(@ROWNUM := @ROWNUM-1, 0) AS NUMROW
					, CMMN_GROUP_CD
					, CMMN_GROUP_NM
					, CMMN_GROUP_DC
					, (CASE
							WHEN MDFR IS NULL THEN WRTER
							WHEN MDFR IS NOT NULL THEN MDFR
							END
						) WRTER
					, (CASE
							WHEN MDFCN_YMD IS NULL THEN DATE_FORMAT(WRT_YMD,'%Y.%m.%d')
							WHEN MDFCN_YMD IS NOT NULL THEN DATE_FORMAT(MDFCN_YMD,'%Y.%m.%d')
							END
						) WRT_YMD
				FROM 
					CMMN_GROUP_CD
					, (SELECT @ROWNUM:=${maxNum} +1) temp
				WHERE 1=1
				AND DEL_YN = 'N'
				ORDER BY CMMN_GROUP_CD DESC
				)S
			WHERE 1=1
			AND NUMROW <=${maxNum}-(#{pageNum}-1)*10
			AND NUMROW>=${maxNum}-(#{pageNum}-1)*10-9
			;
	]]>
	
	</select>


<!-- 공통 그룹 코드 추가 -->
	<insert id="insertCmnCdGroup" parameterType="HashMap">

		/*
		CommonCodeGroupManage.insertCmnCdGroup*/
		
		INSERT INTO
		CMMN_GROUP_CD
		(CMMN_GROUP_CD,CMMN_GROUP_NM,CMMN_GROUP_DC,WRTER,WRT_YMD)
		SELECT
		IFNULL(MAX(CMMN_GROUP_CD*1) + 1, 1)
		,#{CMMN_GROUP_NM}
		,#{CMMN_GROUP_DC}
		,#{WRTER}
		,NOW()
		FROM CMMN_GROUP_CD;

	</insert>
	 
	 <!-- 공통 그룹 코드 상세 조회 -->
	<select id="selectCmnCdGroupDetail" resultType="HashMap"
		parameterType="HashMap">

		/*
		CommonCodeGroupManage.selectCmnCdGroupDetail*/

		SELECT
		CMMN_GROUP_CD
		,CMMN_GROUP_NM
		,CMMN_GROUP_DC
		,(CASE
		WHEN MDFCN_YMD IS NULL THEN
		DATE_FORMAT(WRT_YMD,'%Y.%m.%d')
		WHEN MDFCN_YMD IS NOT NULL THEN
		DATE_FORMAT(MDFCN_YMD,'%Y.%m.%d')
		END
		) WRT_YMD
		,(CASE
		WHEN MDFR IS NULL
		OR MDFR = 'NULL' THEN WRTER
		WHEN MDFR IS NOT NULL THEN MDFR
		END
		) WRTER
		FROM CMMN_GROUP_CD
		WHERE
		CMMN_GROUP_CD = #{CMMN_GROUP_CD}
		AND DEL_YN = "N"

	</select>
	
	<!-- 공통 코드 그룹 삭제 -->
	<update id="deleteCmnCdGroup" parameterType="HashMap">

		/*
		CommonCodeGroupManage.deleteCmnCdGroup*/
		UPDATE
		CMMN_GROUP_CD
		SET
		DEL_YN='Y'
		WHERE
		CMMN_GROUP_CD =
		#{CMMN_GROUP_CD}

	</update>
	
	<!-- 공통 코드 그룹 수정 -->
	<update id="updateCmnCdGroup" parameterType="HashMap">

		/*
		CommonCodeGroupManage.updateCmnCdGroup*/
		UPDATE
		CMMN_GROUP_CD
		SET
		CMMN_GROUP_NM=#{CMMN_GROUP_NM}
		,CMMN_GROUP_DC=#{CMMN_GROUP_DC}
		,MDFR=#{MBR_NM}
		,MDFCN_YMD=NOW()
		WHERE
		CMMN_GROUP_CD =
		#{CMMN_GROUP_CD}

	</update>
	
	<!-- 약관 검색 조건 적용 전체 글 갯수 조회 -->
	<select id="getCommonCodeGroupSearchCount" parameterType="Map" resultType ="Integer">
	
	/*
		CommonCodeGroupManage.getCommonCodeGroupSearchCount*/
	<![CDATA[
	SELECT
		COUNT(*)
	FROM (
		SELECT
			 S.*
		FROM
			(SELECT
			    CMMN_GROUP_CD,
			    CMMN_GROUP_NM,
			    CMMN_GROUP_DC,
			   (CASE
					WHEN MDFR IS NULL OR MDFR = 'NULL' THEN WRTER
					WHEN MDFR IS NOT NULL THEN MDFR
					END
					) WRTER,
			    (
			        CASE
			            WHEN MDFCN_YMD IS NULL THEN DATE_FORMAT(WRT_YMD, '%Y.%m.%d')
			            WHEN MDFCN_YMD IS NOT NULL THEN DATE_FORMAT(MDFCN_YMD, '%Y.%m.%d')
			        END
			     ) WRT_YMD
				FROM CMMN_GROUP_CD 
			    WHERE 1 = 1
			    AND 
			    	DEL_YN = "N"
			    ORDER BY
					CMMN_GROUP_CD DESC
					)S
			
				WHERE 1=1
			    ]]>
					<if test="from != null and to != null">
						AND
						DATE_FORMAT(WRT_YMD,'%Y.%m.%d') BETWEEN #{from} AND
						#{to}
					</if>
					<if test="from != null and to == null">
						AND
						DATE_FORMAT(WRT_YMD,'%Y.%m.%d') BETWEEN #{from} AND
						(SELECT MAX(DATE_FORMAT(WRT_YMD,'%Y.%m.%d')))
					</if>
					<if test="from == null and to != null">
						AND
						DATE_FORMAT(WRT_YMD,'%Y.%m.%d') BETWEEN(SELECT 
						MIN(DATE_FORMAT(WRT_YMD,'%Y.%m.%d'))) AND
						#{to}
					</if>
					<if test="SearchStr != null and SearchType != null">
						<if test="SearchType == 'all'.toString()">
							AND
							CMMN_GROUP_NM LIKE '%${SearchStr}%'
							or CMMN_GROUP_CD LIKE '%${SearchStr}%'
						</if>
						<if test="SearchType == 'sj'.toString()">
							AND CMMN_GROUP_NM LIKE '%${SearchStr}%'
						</if>
			
						<if test="SearchType == 'id'.toString()">
							AND CMMN_GROUP_CD LIKE '%${SearchStr}%'
						</if>
					</if>
					ORDER BY
					CMMN_GROUP_CD DESC
					)D
	</select>
	
	
	<!-- 약관 목록 검색 조회 -->
	<select id="selectCmnCdGroupSearchList" parameterType="HashMap"
		resultType="HashMap">

		/*
		CommonCodeGroupManage.selectCmnCdGroupSearchList*/
		<![CDATA[
	SELECT
		D.*
	FROM (
		SELECT
			 FORMAT(@ROWNUM := @ROWNUM-1, 0) AS NUMROW,
			 S.*
		FROM
			(SELECT
			    CMMN_GROUP_NM,
			    CMMN_GROUP_CD,
			    CMMN_GROUP_DC,
			   (CASE
					WHEN MDFR IS NULL OR MDFR = 'NULL' THEN WRTER
					WHEN MDFR IS NOT NULL THEN MDFR
					END
					) WRTER,
			    (
			        CASE
			            WHEN MDFCN_YMD IS NULL THEN DATE_FORMAT(WRT_YMD, '%Y.%m.%d')
			            WHEN MDFCN_YMD IS NOT NULL THEN DATE_FORMAT(MDFCN_YMD, '%Y.%m.%d')
			        END
			     ) WRT_YMD
				FROM CMMN_GROUP_CD A 
			    WHERE 1 = 1
			    AND 
			    	DEL_YN = "N"
			    ORDER BY
					CMMN_GROUP_CD DESC
					)S
					,(select @ROWNUM:=${maxNum}+1) temp
				WHERE 1=1
			    ]]>
					<if test="from != null and from != ''">
					AND 
						<![CDATA[
						DATE_FORMAT(WRT_YMD,'%Y.%m.%d') >= IFNULL(#{from},'')
						]]>
					</if>
					<if test="to != null and to != ''">
					AND 
						<![CDATA[
						DATE_FORMAT(WRT_YMD,'%Y.%m.%d') <= IFNULL(#{to},'')
						]]>
					</if>
						<if test="SearchStr != null and SearchType != null">
						<if test="SearchType == 'all'.toString()">
							AND
							CMMN_GROUP_NM LIKE '%${SearchStr}%'
							or CMMN_GROUP_CD LIKE '%${SearchStr}%'
						</if>
						<if test="SearchType == 'sj'.toString()">
							AND CMMN_GROUP_NM LIKE '%${SearchStr}%'
						</if>
			
						<if test="SearchType == 'id'.toString()">
							AND CMMN_GROUP_CD LIKE '%${SearchStr}%'
						</if>
					</if>
					ORDER BY
					CMMN_GROUP_CD DESC
					)D
						<![CDATA[
						WHERE 1=1
						AND NUMROW <=#{maxNum}-(#{pageNum}-1)*10
						AND NUMROW>=#{maxNum}-(#{pageNum}-1)*10-9
						;
						]]>

	</select>
	
		<!-- 공통 그룹 코드 글 전체 갯수 + 1  조회 -->
	<select id="getCmnCdGroupMaxCount" resultType="Integer">
		/*
		CommonCodeGroupManage.getCmnCdGroupMaxCount*/
	
		SELECT
			COUNT(*) + 1
		FROM
			CMMN_GROUP_CD
	</select>
</mapper>