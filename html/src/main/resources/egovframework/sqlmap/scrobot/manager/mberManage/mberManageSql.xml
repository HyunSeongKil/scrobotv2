<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MberManage">

<!-- 회원 전체 수 조회 -->
<select id="getMemberCount" resultType="Integer">
		/* MberManage.getMemberCount */
		
			SELECT 
				COUNT(*) AS COUNT_NUM 
			FROM
				MBR
			WHERE 
				WHDWL_YN = "N"
	</select>
	
		<!-- 회원 목록 조회 -->
	<select id="selectMberList" resultType="HashMap">
	
	/* MberManage.selectMberList */
	
	<![CDATA[
		SELECT S.*
			FROM(
				SELECT
					FORMAT(@ROWNUM := @ROWNUM-1, 0) AS NUMROW
					, MBR_NM
					, MBR_ID
					, MBR_TELNO
					, GDS_ID
					, AUTHOR_ID
				FROM 
					MBR
					, (SELECT @ROWNUM:=${maxNum} +1) temp
				WHERE 1=1
				AND WHDWL_YN = 'N'
				ORDER BY JOIN_YMD DESC
				)S
			WHERE 1=1
			AND NUMROW <=${maxNum}-(#{pageNum}-1)*10
			AND NUMROW>=${maxNum}-(#{pageNum}-1)*10-9
			;
	]]>
	
	</select>
	
	
	<!-- 회원 검색 조건 적용 전체 갯수 조회 -->
	<select id="getMberSearchCount" parameterType="Map" resultType ="Integer">
	
	/*
		MberManage.getMberSearchCount*/
	<![CDATA[
	SELECT
		COUNT(*)
	FROM (
		SELECT
			 S.*
		FROM
			(SELECT
			    MBR_ID,
			    MBR_NM,
			    MBR_TELNO,
			   	GDS_ID,
			   	AUTHOR_ID,
			   	JOIN_YMD
				FROM MBR 
			    WHERE 1 = 1
			    AND 
			    	WHDWL_YN = "N"
			    ORDER BY
					JOIN_YMD DESC
					)S
			
				WHERE 1=1
			    ]]>
					<if test="from != null and to != null">
						AND
						DATE_FORMAT(JOIN_YMD,'%Y.%m.%d') BETWEEN #{from} AND
						#{to}
					</if>
					<if test="from != null and to == null">
						AND
						DATE_FORMAT(JOIN_YMD,'%Y.%m.%d') BETWEEN #{from} AND
						(SELECT MAX(DATE_FORMAT(JOIN_YMD,'%Y.%m.%d')))
					</if>
					<if test="from == null and to != null">
						AND
						DATE_FORMAT(JOIN_YMD,'%Y.%m.%d') BETWEEN(SELECT 
						MIN(DATE_FORMAT(JOIN_YMD,'%Y.%m.%d'))) AND
						#{to}
					</if>
					<if test="SearchStr != null and SearchType != null">
						<if test="SearchType == 'all'.toString()">
							AND
							(MBR_NM LIKE '%${SearchStr}%' OR
							 MBR_NM LIKE '%${SearchStr}%' OR
							 MBR_ID LIKE '%${SearchStr}%' OR
							 GDS_ID LIKE '%${SearchStr}%' OR
							 AUTHOR_ID LIKE '%${SearchStr}%'
							)
						</if>
						<if test="SearchType == 'nm'.toString()">
							AND MBR_NM LIKE '%${SearchStr}%'
						</if>
						<if test="SearchType == 'email'.toString()">
							AND MBR_ID LIKE '%${SearchStr}%'
						</if>
						<if test="SearchType == 'gds'.toString()">
							AND GDS_ID LIKE '%${SearchStr}%'
						</if>
						<if test="SearchType == 'author'.toString()">
							AND AUTHOR_ID LIKE '%${SearchStr}%'
						</if>
		
					</if>
					ORDER BY
					JOIN_YMD DESC
					)D
	</select>
	
	<!-- 회원 검색 조회 -->
	<select id="selectMberSearchList" parameterType="HashMap"
		resultType="HashMap">

		/*
		MberManage.selectMberSearchList*/
		<![CDATA[
	SELECT
		D.*
	FROM (
		SELECT
			 FORMAT(@ROWNUM := @ROWNUM-1, 0) AS NUMROW,
			 S.*
		FROM
			(SELECT
			    MBR_ID,
			    MBR_NM,
			    MBR_TELNO,
			   	GDS_ID,
			   	AUTHOR_ID,
			   	JOIN_YMD
			     
				FROM MBR A 
			    WHERE 1 = 1
			    AND 
			    	WHDWL_YN = "N"
			    ORDER BY
					JOIN_YMD DESC
					)S
					,(select @ROWNUM:=${maxNum}+1) temp
				WHERE 1=1
			    ]]>
					<if test="from != null and from != ''">
					AND 
						<![CDATA[
						DATE_FORMAT(JOIN_YMD,'%Y.%m.%d') >= IFNULL(#{from},'')
						]]>
					</if>
					<if test="to != null and to != ''">
					AND 
						<![CDATA[
						DATE_FORMAT(JOIN_YMD,'%Y.%m.%d') <= IFNULL(#{to},'')
						]]>
					</if>
						<if test="SearchStr != null and SearchType != null">
						<if test="SearchType == 'all'.toString()">
							AND
							(MBR_NM LIKE '%${SearchStr}%' OR
							 MBR_NM LIKE '%${SearchStr}%' OR
							 MBR_ID LIKE '%${SearchStr}%' OR
							 GDS_ID LIKE '%${SearchStr}%' OR
							 AUTHOR_ID LIKE '%${SearchStr}%'
							)
						</if>
						<if test="SearchType == 'nm'.toString()">
							AND MBR_NM LIKE '%${SearchStr}%'
						</if>
						<if test="SearchType == 'email'.toString()">
							AND MBR_ID LIKE '%${SearchStr}%'
						</if>
						<if test="SearchType == 'gds'.toString()">
							AND GDS_ID LIKE '%${SearchStr}%'
						</if>
						<if test="SearchType == 'author'.toString()">
							AND AUTHOR_ID LIKE '%${SearchStr}%'
						</if>
		
					</if>
					ORDER BY
					JOIN_YMD DESC
					)D
						<![CDATA[
						WHERE 1=1
						AND NUMROW <=#{maxNum}-(#{pageNum}-1)*10
						AND NUMROW>=#{maxNum}-(#{pageNum}-1)*10-9
						;
						]]>

	</select>
	
	<!-- 회원 상세 조회 -->
	<select id="selectMberDetail" resultType="HashMap"
		parameterType="HashMap">

		/*
		MberManage.selectMberDetail*/

		SELECT
		MBR_ID,
	    MBR_NM,
		MBR_TELNO,
		GDS_ID,
		AUTHOR_ID,
		JOIN_YMD
		FROM MBR
		WHERE
		MBR_ID = #{MBR_ID}
		AND WHDWL_YN = "N"

	</select>
	
	<!-- 회원 구매 목록 전체 수 조회 -->
	<select id="getMemberStlmCount" resultType="Integer"
		parameterType="HashMap">
		/* MberManage.getMemberStlmCount */
		
			SELECT 
				COUNT(*) AS COUNT_NUM 
			FROM
				STLM
			WHERE 
				MBR_ID = #{MBR_ID}
	</select>
	
	<!-- 회원 구매 목록 조회 -->
	<select id="selectMberStlmList" resultType="HashMap"
		parameterType="HashMap">

		/*
		MberManage.selectMberStlmList*/

		SELECT
		STLM_NO,
	    MBR_ID,
		B.GDS_NM as GDS_NM,
		STLM_YMD,
		STLM_AMT
		FROM STLM A
		INNER JOIN GDS B 
		ON A.GDS_ID = B.GDS_ID
		WHERE 
		MBR_ID = #{MBR_ID}
		;

	</select>
	
	<!-- 회원 프로젝트 목록 전체 수 조회 -->
	<select id="getMemberPrjctCount" resultType="Integer"
		parameterType="HashMap">
		/* MberManage.getMemberPrjctCount */
		
			SELECT 
				COUNT(*) AS COUNT_NUM 
			FROM
				MBR_PRJCT
			WHERE 
				MBR_ID = #{MBR_ID}
	</select>
	
	<!-- 회원 프로젝트 목록 조회 -->
	<select id="selectMberPrjctList" resultType="HashMap"
		parameterType="HashMap">

		/*
		MberManage.selectMberPrjctList*/

		SELECT
		A.PRJCT_ID AS PRJCT_ID,
		B.PRJCT_NM AS PRJCT_NM,
		B.STRG_DT AS STRG_DT, 
		A.PRJCTMNGR_YN AS PRJCTMNGR_YN
		FROM MBR_PRJCT A
		INNER JOIN PRJCT B 
		ON A.MBR_ID = B.MBR_ID
		WHERE 
		A.MBR_ID = #{MBR_ID}
		;
	</select>
	
	
	<!-- 회원 1대1 문의 목록 전체 수 조회 -->
	<select id="getMemberBbsCount" resultType="Integer"
		parameterType="HashMap">
		/* MberManage.getMemberBbsCount */
		
			SELECT 
				COUNT(*) AS COUNT_NUM 
			FROM
				INQRY_BBS
			WHERE 
				MBR_ID = #{MBR_ID}
	</select>
	
	<!-- 회원 1대1 목록 조회 -->
	<select id="selectMberBbsList" resultType="HashMap"
		parameterType="HashMap">

		/*
		MberManage.selectMberBbsList*/

		 SELECT BBSCTT_TY ,
		 		BBSCTT_SJ ,
		 		WRT_YMD ,
		 		MBR_ID ,
		 		ANS_WTH
		 FROM INQRY_BBS
		 WHERE MBR_ID = #{MBR_ID}
	</select>
	
	<!-- 탈퇴 회원 전체 수 조회 -->
	<select id="getMemberSecsnCount" resultType="Integer">
		/* MberManage.getMemberSecsnCount */
		
			SELECT 
				COUNT(*) AS COUNT_NUM 
			FROM
				MBR
			WHERE 
				WHDWL_YN = "Y"
	</select>
	
	
		<!-- 탈퇴 회원 목록 조회 -->
	<select id="selectMberSecsnList" resultType="HashMap">
	
	/* MberManage.selectMberSecsnList */
	
	<![CDATA[
		SELECT S.*
			FROM(
				SELECT
					FORMAT(@ROWNUM := @ROWNUM-1, 0) AS NUMROW
					, MBR_NM
					, MBR_ID
					, MBR_TELNO
					, JOIN_YMD
					, WHDWL_YMD
					, IMPRVM_MATTER
				FROM 
					MBR
					, (SELECT @ROWNUM:=${maxNum} +1) temp
				WHERE 1=1
				AND WHDWL_YN = 'Y'
				ORDER BY WHDWL_YMD DESC
				)S
			WHERE 1=1
			AND NUMROW <=${maxNum}-(#{pageNum}-1)*10
			AND NUMROW >=${maxNum}-(#{pageNum}-1)*10-9
			;
	]]>
	
	</select>
	
	<!-- 탈퇴 회원 검색 조건 적용 전체 갯수 조회 -->
	<select id="getMberSearchSecsnCount" parameterType="Map" resultType ="Integer">
	
	/*
		MberManage.getMberSearchSecsnCount*/
	<![CDATA[
	SELECT
		COUNT(*)
	FROM (
		SELECT
			 S.*
		FROM
			(SELECT
			    MBR_ID,
			    MBR_NM,
			    MBR_TELNO,
			   	JOIN_YMD,
			   	WHDWL_YMD,
			   	WHDWL_RSN
				FROM MBR 
			    WHERE 1 = 1
			    AND 
			    	WHDWL_YN = "Y"
			    ORDER BY
					JOIN_YMD DESC
					)S
			
				WHERE 1=1
			    ]]>
					<if test="from != null and to != null">
						AND
						DATE_FORMAT(JOIN_YMD,'%Y.%m.%d') BETWEEN #{from} AND
						#{to}
					</if>
					<if test="from != null and to == null">
						AND
						DATE_FORMAT(JOIN_YMD,'%Y.%m.%d') BETWEEN #{from} AND
						(SELECT MAX(DATE_FORMAT(JOIN_YMD,'%Y.%m.%d')))
					</if>
					<if test="from == null and to != null">
						AND
						DATE_FORMAT(JOIN_YMD,'%Y.%m.%d') BETWEEN(SELECT 
						MIN(DATE_FORMAT(JOIN_YMD,'%Y.%m.%d'))) AND
						#{to}
					</if>
					<if test="SearchStr != null and SearchType != null">
						<if test="SearchType == 'all'.toString()">
							AND
						(	MBR_NM LIKE '%/${SearchStr}%' ESCAPE '/'
						OR
							MBR_ID LIKE '%/${SearchStr}%' ESCAPE '/'
						)
						</if>
						<if test="SearchType == 'sj'.toString()">
							AND MBR_NM LIKE '%${SearchStr}%'
						</if>
						<if test="SearchType == 'email'">
						AND
							MBR_ID LIKE '%/${SearchStr}%' ESCAPE '/'
						 </if>
					</if>
					ORDER BY
					WHDWL_YMD DESC
					)D
	</select>
	
	<!-- 탈퇴 회원 검색 조회 -->
	<select id="selectMberSecsnSearchList" parameterType="HashMap"
		resultType="HashMap">

		/*
		MberManage.selectMberSecsnSearchList*/
		<![CDATA[
	SELECT
		D.*
	FROM (
		SELECT
			 FORMAT(@ROWNUM := @ROWNUM-1, 0) AS NUMROW,
			 S.*
		FROM
			(SELECT
			   MBR_ID,
			    MBR_NM,
			    MBR_TELNO,
			   	JOIN_YMD,
			   	WHDWL_YMD,
			   	WHDWL_RSN
	  
				FROM MBR A 
			    WHERE 1 = 1
			    AND 
			    	WHDWL_YN = "Y"
			    ORDER BY
					JOIN_YMD DESC
					)S
					,(select @ROWNUM:=${maxNum}+1) temp
				WHERE 1=1
			    ]]>
					<if test="from != null and from != ''">
					AND 
						<![CDATA[
						DATE_FORMAT(JOIN_YMD,'%Y.%m.%d') >= IFNULL(#{from},'')
						]]>
					</if>
					<if test="to != null and to != ''">
					AND 
						<![CDATA[
						DATE_FORMAT(JOIN_YMD,'%Y.%m.%d') <= IFNULL(#{to},'')
						]]>
					</if>
						<if test="SearchStr != null and SearchType != null">
						<if test="SearchType == 'all'">
						AND
						(	MBR_NM LIKE '%/${SearchStr}%' ESCAPE '/'
						OR
							MBR_ID LIKE '%/${SearchStr}%' ESCAPE '/'
						)
						 </if> 
						 <if test="SearchType == 'sj'">
						AND
							MBR_NM LIKE '%/${SearchStr}%' ESCAPE '/'
						 </if>
						 <if test="SearchType == 'email'">
						AND
							MBR_ID LIKE '%/${SearchStr}%' ESCAPE '/'
						 </if>
					 </if>
					ORDER BY
					WHDWL_YMD DESC
					)D
						<![CDATA[
						WHERE 1=1
						AND NUMROW <=#{maxNum}-(#{pageNum}-1)*10
						AND NUMROW>=#{maxNum}-(#{pageNum}-1)*10-9
						;
						]]>

	</select>
	
		<!-- 탈퇴 회원 상세 조회 -->
	<select id="selectMberSecsnDetail" resultType="HashMap"
		parameterType="HashMap">

		/*
		MberManage.selectMberSecsnDetail*/

		SELECT
		MBR_ID,
	    MBR_NM,
		MBR_TELNO,
		JOIN_YMD,
		WHDWL_YMD,
		WHDWL_RSN,
		IMPRVM_MATTER
		FROM MBR
		WHERE
		MBR_ID = #{MBR_ID}
		AND WHDWL_YN = "Y"

	</select>
</mapper>